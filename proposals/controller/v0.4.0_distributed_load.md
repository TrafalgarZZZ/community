<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Motivation](#motivation)
- [Goals](#goals)
- [Non-Goals](#non-goals)
- [API](#api)
  - [Resulting AlluxioRuntime](#resulting-alluxioruntime)
  - [Resulting AlluxioRuntime.Status](#resulting-alluxioruntimestatus)
- [Workflow](#workflow)
- [Limitations](#limitations)
- [Test](#test)
- [Alternative Considered](#alternative-considered)
- [Commits](#commits)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Motivation

为了保证应用在使用数据集时保持较高的资源利用率，保障应用的性能，Fluid应当为用户提供**数据预热**的支持。根据用户需要，Fluid需要将用户部署的数据集提前加载进分布式数据缓存引擎中，使得应用在访问对应的数据集时，不再需要从远程存储系统拉取，以保证应用的数据访问能力,避免计算资源等待IO的情况频繁发生，提高计算资源利用率

Alluxio提供了`alluxio fs distributedLoad`命令完成数据的分布式加载操作，然而对于较大的数据集该分布式加载操作时间较长，因此为了保证Fluid的其他功能(例如：数据集缓存可观测性)不受该操作影响，该分布式加载操作应该以异步的方式集成至Fluid中

## Goals
- 提供数据预热支持，将数据加载至分布式缓存
- 根据用户配置可开启或关闭的数据预热能力
- 异步的数据预热过程
- 分布式加载时可配置的数据副本数量(alluxio fs distributedLoad --replication)
- 可配置仅加载某数据集下的某子目录

## Non-Goals
- 暂不支持将数据加载至各个Dataset部署结点的Kernel Cache中的操作

## API

### Resulting AlluxioRuntime

```yaml
apiVersion: data.fluid.io/v1alpha1
kind: AlluxioRuntime
metadata:
  ...
spec:
  ...
  data:
    replicas: 2
    preload:
      enabled: true
      path: /datasets/imagenet/v1
```
在AlluxioRuntime的yaml配置中增加`spec.data.preload`属性，包含以下内容：
- enabled: 是否进行数据预热，默认为开启(true)
- path: 数据预热的子路径，默认为`/`，即全部数据

在进行分布式加载时，使用的数据副本数量(--replication)将由`spec.data.replicas`指定，默认为1

### Resulting AlluxioRuntime.Status
```yaml
apiVersion: data.fluid.io/v1alpha1
kind: AlluxioRuntime
metadata:
  ...
spec:
  ...
status:
  ...
  preloadStatus: NotStarted
  ...
```

`status.preloadStatus`持久化地数据预热的完成状态，包含以下几个Phase:
- PhaseNone = "": 初始状态
- PhaseNotStarted = "NotStarted": 数据预热未开始，如果用户设置数据预热`enabled: false`将保持该状态
- PhaseDisLoading = "DisLoading": 正在进行分布式加载
- PhaseLoaded = "Loaded": 全部数据分布式加载已完成

## Workflow

1. 用户提交AlluxioRuntime CRD，runtime controller按照用户配置或默认配置获得与数据预热相关信息，设置`status.preloadStatus`状态为`PhaseNotStarted`

2. 如果数据预热开启，则在以下两个步骤均完成之后由runtime controller发起DistributedLoad操作：
    - 数据元信息加载完成 （仅需LoadMetadata完成，元信息查询可与DistributedLoad并行执行）
    - 各Alluxio Worker就绪

    具体执行方式为：runtime controller在Alluxio Master Pod中执行`alluxio fs distributedLoad --replication <replicas> <path>`指令
    执行上述命令后，设置`status.preloadStatus`为`PhaseDisLoading`

3. 周期性异步查询上述命令执行结果(此处参考已有的元信息初始化的异步实现)，等待`distributedLoad`操作完成。完成后，将`status.preloadStatus`设置为`PhaseLoaded`

## Limitations
- distributedLoad操作存在无法将数据全部导入的问题 ([Alluxio/Alluxio#12116](https://github.com/Alluxio/alluxio/issues/12116))
- [目前实现](https://github.com/fluid-cloudnative/fluid/pull/225)中元数据的加载和查询没有进行拆分，无法得知数据元信息加载完成的信息

## Test

验证目标：

1. 可以支持异步的数据分布式加载，即使加载过程较长，不应阻塞Fluid对其他事件的处理
2. 分布式加载过程可通过查看数据缓存情况被观测到
4. 通过`alluxio fs ls`可验证仅子目录被成功加载的结果
5. 整个数据预热过程应当与`status.preloadStatus`中的状态保持一致

## Alternative Considered

## Commits
